# ================= Base =================
set -sg escape-time 0
set -g repeat-time 300

set -g history-limit 200000

# Update environment variables when attaching (fixes Wayland in new sessions)
set -g update-environment "WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_TYPE DISPLAY SWAYSOCK HYPRLAND_INSTANCE_SIGNATURE"

set -g default-terminal "xterm-256color"
set -as terminal-overrides ",xterm-256color:Tc"
set -ga terminal-features ",*:24-bit:RGB"

# ================= Kill the real status bar =================
set -g status off

# ================= Pane footer as our "status bar" =================
# Pane footer as status
set -g pane-border-status bottom
set -g pane-border-style "fg=colour240"
set -g pane-active-border-style "fg=colour213"

# ================= Pane Visibility - Active pane emphasis =================
# Inactive panes transparent, active pane has background
set -g window-style 'fg=#aaaaaa,bg=default'
set -g window-active-style 'fg=#ffffff,bg=#1a0d1a'

# Longer display time for pane numbers (prefix + q)
set -g display-panes-time 3000
set -g display-panes-active-colour colour213
set -g display-panes-colour colour240

# Pretty clock mode (Ctrl+a t)
set -g clock-mode-colour colour213
set -g clock-mode-style 24

# Message styling
set -g message-style 'fg=#ffffff,bg=#f5a9b8,bold'
set -g message-command-style 'fg=#ffffff,bg=#c77a9a'

# Copy mode styling
set -g mode-style 'fg=#0d0d1a,bg=#f5a9b8'

# Pane border format with active indicator
set -g pane-border-format ' #{?pane_active,#[fg=#f5a9b8]◆,#[fg=colour240]◇} #[fg=colour240]#S:#I #{?pane_active,#[fg=#f5a9b8],#[fg=colour240]}│ #(~/.local/bin/tmux-git-pane-label "#{pane_current_path}") '

# ================= Keys / panes =================
set -g prefix C-a
unbind C-b
bind C-a send-prefix

set -g mouse on
set -g focus-events on

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind -r H resize-pane -L 3
bind -r J resize-pane -D 3
bind -r K resize-pane -U 3
bind -r L resize-pane -R 3

bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"
bind Tab last-window
unbind '"'
unbind %
# Prefix + m = move current pane to a brand-new session
bind m run-shell ' \
    new_sess="sess_$(date +%s)"; \
    tmux break-pane -d; \
    last_win=$(tmux list-windows -F "#{window_index}" | tail -n1); \
    tmux new-session -d -s "$new_sess"; \
    tmux move-window -s :"$last_win" -t "$new_sess":; \
    tmux display-message "Pane moved to new session: $new_sess" \
'

set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
setw -g mode-keys vi

# Copy mode with system clipboard
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "wl-copy"

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config Reloaded"

#key bind for nested sessions
bind -n C-S-a send-prefix
